(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{333:function(e,t,n){e.exports=n.p+"img/insideLogo.85c1f01.svg"},350:function(e,t,n){"use strict";n.r(t);var r=n(13),o=(n(60),n(59),n(21),n(47)),c={name:"login",data:function(){return{member:{phone:"",verifyCode:""},isLogin:!1,getingCode:!1,getCodeWaitingTimer:null,token:Object(o.b)()||"",merchantId:"",designerId:""}},computed:{isLoading:function(){return this.$store.state.loading.isLoading}},methods:{getVerifyCode:function(){var e=this;if(!this.member.phone)return this.$swal.fire({icon:"warning",title:'<h3 class="text-2xl">請輸入手機號碼</h3>',background:"#fff",iconColor:"#FEB401",timer:1500,showConfirmButton:!1}).then((function(){setTimeout((function(){e.$refs.phoneRef.focus()}),300)}));this.getingCode=!0,this.$api.customerLoginSMSWithTKN(this.member.phone).then((function(t){e.getingCode=!1,e.getCodeWaitingTimer=60;var n=setInterval((function(){e.getCodeWaitingTimer<=1?(clearInterval(n),e.getCodeWaitingTimer=null):e.getCodeWaitingTimer--}),1e3);t.hasError?(clearInterval(n),e.getCodeWaitingTimer=null):e.$swal.fire({icon:"success",title:'<h3 class="text-2xl">已傳送簡訊至<span class="text-[#FEB401]">'.concat(e.member.phone,"</span></h3>"),background:"#fff",iconColor:"#FEB401",timer:1500,showConfirmButton:!1})})).catch((function(t){clearInterval(timer),e.getCodeWaitingTimer=null,e.getingCode=!1,console.log(t),e.$swal.fire({icon:"error",title:'<h3 class="text-2xl">發生錯誤，請稍後再試</h3>',background:"#fff",iconColor:"#FEB401",timer:1500,showConfirmButton:!1})}))},login:function(){var e=this;if(!this.isLogin){this.isLogin=!0;var input={cellphone:this.member.phone,code:this.member.verifyCode};this.$api.customerVerifySMSWithTKN(input,"\n        token,\n        name,\n        cellphone,\n        isNewCustomer\n        merchants{\n          id,\n          name,\n          address,\n          availableBookingTime{\n            time\n          }\n        },\n        currentMerchant{\n          id,\n          name,\n          address,\n          shopURL,\n          rankingURL,\n          availableBookingTime{\n            time\n          }\n        }\n      ").then((function(t){if(t.hasError)e.isLogin=!1;else{e.$cookieMethods.setToken(t.data.customerVerifySMSWithTKN.token),localStorage.setItem("allMerchants",JSON.stringify(t.data.customerVerifySMSWithTKN.merchants)),localStorage.setItem("isNewCustomer",JSON.stringify(t.data.customerVerifySMSWithTKN.isNewCustomer));var n=!!JSON.parse(localStorage.getItem("isNewCustomer"));localStorage.setItem("isNewCustomerAndNomerchant",n),e.api.updateCustomerCuttentMerchant(e.merchantId).then(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.hasError){t.next=2;break}throw n.errors;case 2:if(!e.designerId){t.next=7;break}return t.next=5,e.api.updateCustomerPreferDesigner(e.designerId,e.merchantId).then(Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.customerGetCurrentMerchantSetting().then(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){var dt;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.data.hasError){t.next=7;break}return dt=n.data.customerGetCurrentMerchantSetting,e.setLocalStorage(dt),e.isChanging=!1,t.next=6,e.alertLoginSuccess();case 6:e.saveDataAndDoRouter();case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)}))));case 5:t.next=9;break;case 7:return t.next=9,e.api.customerGetCurrentMerchantSetting().then(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(n){var dt;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.data.hasError){t.next=7;break}return dt=n.data.customerGetCurrentMerchantSetting,e.setLocalStorage(dt),e.isChanging=!1,t.next=6,e.alertLoginSuccess();case 6:e.saveDataAndDoRouter();case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.isLogin=!1,console.log(t)}))}})).catch((function(t){e.isLogin=!1,console.log(t)}))}},updateCurrentMerchantAndDesigner:function(){var e=this;this.api.updateCustomerCuttentMerchant(this.merchantId).then(Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.designerId){t.next=4;break}return t.next=3,e.ifhasLoginGetCurrentMerchantSetting();case 3:return t.abrupt("return");case 4:return t.next=6,e.api.updateCustomerPreferDesigner(e.designerId,e.merchantId).then(Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ifhasLoginGetCurrentMerchantSetting();case 2:case"end":return t.stop()}}),t)}))));case 6:case"end":return t.stop()}}),t)})))).catch((function(t){e.isLogin=!1,console.log(t)}))},ifhasLoginGetCurrentMerchantSetting:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.customerGetCurrentMerchantSetting().then((function(t){if(!t.data.hasError){var dt=t.data.customerGetCurrentMerchantSetting;e.setLocalStorage(dt),e.saveDataAndDoRouter()}}));case 2:case"end":return t.stop()}}),t)})))()},setLocalStorage:function(dt){localStorage.setItem("allMerchants",JSON.stringify(dt.consumedMerchants)),localStorage.setItem("merchant",JSON.stringify(dt.currentMerchant)),localStorage.setItem("preferDesigner",JSON.stringify(dt.preferDesigner))},alertLoginSuccess:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$swal.fire({icon:"success",title:'<h3 class="text-2xl">登入成功</h3>',background:"#fff",iconColor:"#FEB401",timer:1500,showConfirmButton:!1});case 2:case"end":return t.stop()}}),t)})))()},saveDataAndDoRouter:function(){var e=JSON.parse(localStorage.getItem("merchant")),t=JSON.parse(localStorage.getItem("preferDesigner")),data={merchantId:e.id,merchantName:e.name,designerId:t?t.id:"",designerName:t?t.name:"",designerNickName:t?t.nickName:""};this.$store.dispatch("appointmentData/handleSetDesignerAndMerchant",data),this.isLogin=!1,this.$router.push("/member/appointment")}},mounted:function(){this.$store.dispatch("loading/isLoading",!0),this.merchantId=this.$route.query.merchantId||"",this.designerId=this.$route.query.designerId||"",this.token?this.updateCurrentMerchantAndDesigner():this.$store.dispatch("loading/isLoading",!1)}},l=c,d=n(33),component=Object(d.a)(l,(function(){var e=this,t=e._self._c;return t("section",[e.isLoading?e._e():t("client-only",[t("header",{pre:!0,attrs:{class:"w-full pb-4 fixed top-5 left-0 z-10"}},[t("div",{pre:!0,attrs:{class:"w-[90%] mx-auto"}},[t("h1",[t("img",{pre:!0,attrs:{src:n(333),alt:"bos客戶預約系統"}})])])]),e._v(" "),t("div",{staticClass:"flex flex-col w-full px-[10%] h-[100vh] overflow-x-hidden overflow-y-hidden gap-10 justify-center items-center bg-[#f1f1f1]"},[t("h2",{pre:!0,attrs:{"data-aos":"fade-up","data-aos-once":"true","data-aos-delay":"100","data-aos-duration":"700",class:"text-black text-lg"}},[e._v("\r\n          會員登入\r\n        ")]),e._v(" "),t("div",{staticClass:"flex flex-col w-full max-w-[450px] justify-start",attrs:{"data-aos":"fade-up","data-aos-once":"true","data-aos-delay":"250","data-aos-duration":"700"}},[t("ValidationObserver",{scopedSlots:e._u([{key:"default",fn:function(n){var r=n.handleSubmit;return[t("form",{on:{submit:function(t){return t.preventDefault(),r(e.login)}}},[t("label",{pre:!0,attrs:{for:"phoneInput",class:"text-black text-sm"}},[e._v("手機：")]),e._v(" "),t("div",{staticClass:"form-group relative mb-10 mt-2"},[t("ValidationProvider",{staticClass:"w-full",attrs:{name:"手機",rules:"required|onlyNumber"},scopedSlots:e._u([{key:"default",fn:function(n){var r=n.errors;return[t("input",{directives:[{name:"model",rawName:"v-model",value:e.member.phone,expression:"member.phone"}],ref:"phoneRef",staticClass:"w-full p-2.5 rounded-xl focus:outline-none border border-[#aeaeae]",class:{"ring-2 ring-[#ff4444]":r.length>0},attrs:{onpaste:"return false",maxlength:"10",id:"phoneInput",type:"tel"},domProps:{value:e.member.phone},on:{input:function(t){t.target.composing||e.$set(e.member,"phone",t.target.value)}}}),e._v(" "),r.length>0?t("span",{staticClass:"absolute left-3 md:left-10 -bottom-5 text-red-500 text-xs font-bold"},[e._v(e._s(r[0]))]):e._e()]}}],null,!0)})],1),e._v(" "),t("label",{pre:!0,attrs:{for:"verifyInput",class:"text-black text-sm sm:text-black"}},[e._v("驗證碼：")]),e._v(" "),t("div",{staticClass:"form-group relative mt-2"},[t("ValidationProvider",{staticClass:"w-full",attrs:{name:"驗證碼",rules:"required|onlyNumber"},scopedSlots:e._u([{key:"default",fn:function(n){var r=n.errors;return[t("input",{directives:[{name:"model",rawName:"v-model",value:e.member.verifyCode,expression:"member.verifyCode"}],staticClass:"w-full p-2.5 rounded-xl focus:outline-none border border-[#aeaeae]",class:{"ring-2 ring-[#ff4444]":r.length>0},attrs:{minlength:"5",maxlength:"5",id:"verifyInput",type:"tel"},domProps:{value:e.member.verifyCode},on:{input:function(t){t.target.composing||e.$set(e.member,"verifyCode",t.target.value)}}}),e._v(" "),r.length>0?t("span",{staticClass:"absolute left-3 md:left-10 -bottom-5 text-red-500 text-xs font-bold"},[e._v(e._s(r[0]))]):e._e(),e._v(" "),t("button",{staticClass:"absolute right-0 bottom-0 h-full p-2.5 text-white text-sm rounded-[0_12px_12px_0] flex items-center gap-1",class:{"bg-[#FEB401]":!e.getCodeWaitingTimer,"bg-[#bebebe]":e.getCodeWaitingTimer||e.getingCode},attrs:{type:"button",disabled:e.getCodeWaitingTimer||e.getingCode},on:{click:e.getVerifyCode}},[e.getingCode?t("fa",{staticClass:"animate-spin-slow",attrs:{icon:"fa-solid fa-spinner"}}):e._e(),e._v("\r\n                    取得驗證碼\r\n                    "),e.getCodeWaitingTimer?t("p",[e._v("\r\n                      ("+e._s(e.getCodeWaitingTimer)+")\r\n                    ")]):e._e()],1)]}}],null,!0)})],1),e._v(" "),t("button",{staticClass:"w-full py-3 text-white text-sm mt-10 bg-[#2f3549] rounded-xl shadow-md flex justify-center items-center gap-3 duration-300",class:{"bg-[#555555]":e.isLogin},attrs:{disabled:e.isLogin,type:"submit"}},[e.isLogin?t("fa",{staticClass:"animate-spin-slow",attrs:{icon:"fa-solid fa-spinner"}}):e._e(),e._v("\r\n                登入\r\n              ")],1)])]}}],null,!1,4238627463)})],1)])])],1)}),[],!1,null,null,null);t.default=component.exports}}]);
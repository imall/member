(window.webpackJsonp=window.webpackJsonp||[]).push([[20,4,6],{331:function(t,e,n){"use strict";n.r(e);var o={props:{isEdit:{type:Boolean,default:function(){return!1}},height:{type:String,default:function(){return"min-h-[40px]"}},py:{type:String,default:function(){return"py-3"}},px:{type:String,default:function(){return"px-3"}},my:{type:String,default:function(){return"mb-2.5"}},mx:{type:String,default:function(){return""}},customCss:{type:String,default:function(){return""}}},name:"MemberGlobalCard"},r=n(33),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("section",[e("div",{staticClass:"w-full bg-white rounded-md relative",class:[t.height,t.px,t.py,t.mx,t.my,t.customCss,{"shadow-[0px_0px_4px_1px_#F1FF99]":t.isEdit,"shadow-[0px_2px_2px_rgba(0,0,0,0.25)]":!t.isEdit}]},[t._t("default")],2)])}),[],!1,null,null,null);e.default=component.exports},332:function(t,e,n){"use strict";n.r(e);var o={computed:{isLoading:function(){return this.$store.state.itemLoading.isLoading}}},r=n(33),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("section",[e("transition",{attrs:{name:"fade"}},[t.isLoading?e("div",{staticClass:"w-full min-h-[100px] flex items-center justify-center pointer-events-none z-50"},[e("div",{staticClass:"border-[5px] border-[#e2e2e2] border-t-[5px] border-t-[#232D4E] rounded-full w-10 h-10 animate-spin-slow"})]):t._e()])],1)}),[],!1,null,null,null);e.default=component.exports},336:function(t,e,n){var content=n(349);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(100).default)("09539e34",content,!0,{sourceMap:!1})},348:function(t,e,n){"use strict";n(336)},349:function(t,e,n){var o=n(99)((function(i){return i[1]}));o.push([t.i,".question{width:30px;height:30px;line-height:30px;text-align:center;font-weight:700;border-radius:50%;position:absolute;border:2px solid #000;color:#000;top:10px;right:10px}",""]),o.locals={},t.exports=o},359:function(t,e,n){"use strict";n.r(e);n(21);var o=n(13),r=(n(25),n(50),n(11),n(60),n(79)),c={name:"member-appointmentRecord",head:function(){return{meta:[{name:"theme-color",content:"#ffffff"}]}},data:function(){return{appointmentRecord:[],selectTab:"未完成",currentPage:0,totalPage:0,isGetting:!1,isEnd:!1,getting:"",isCancel:""}},computed:{isLoading:function(){return this.$store.state.loading.isLoading}},methods:{getNotDoneOrders:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("notDoneOrders"!==t.getting){e.next=2;break}return e.abrupt("return");case 2:return t.getting="notDoneOrders",Object(r.b)(),t.$store.dispatch("loading/isLoading",!0),t.appointmentRecord=[],t.isEnd=!1,t.currentPage=0,"id, no, date, designer{name, nickName}, status, remarkForCustomer, messageForCustomer,troubleShooting",e.next=11,t.api.getNotDoneCustomerReservationRecords("id, no, date, designer{name, nickName}, status, remarkForCustomer, messageForCustomer,troubleShooting",t.currentPage).then((function(e){(t.appointmentRecord=e.data.getCustomerReservationRecords.orders,t.totalPage=Math.ceil(e.data.getCustomerReservationRecords.totalCount/20),t.totalPage<=1&&(t.isEnd=!0),t.totalPage>1)&&document.querySelector(".member__container").addEventListener("scroll",t.scrollGetOrders);console.log(t.appointmentRecord),t.getting="",t.$store.dispatch("loading/isLoading",!1)})).catch((function(e){t.getting="",console.log(e)}));case 11:case"end":return e.stop()}}),e)})))()},getDoneOrders:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("dontOrders"!==t.getting){e.next=2;break}return e.abrupt("return");case 2:return t.getting="dontOrders",Object(r.b)(),t.$store.dispatch("loading/isLoading",!0),t.appointmentRecord=[],t.isEnd=!1,t.currentPage=0,"id, no, date, designer{name, nickName}, status, remarkForCustomer",e.next=11,t.api.getDoneCustomerReservationRecords("id, no, date, designer{name, nickName}, status, remarkForCustomer",t.currentPage).then((function(e){(t.appointmentRecord=e.data.getCustomerReservationRecords.orders,t.totalPage=Math.ceil(e.data.getCustomerReservationRecords.totalCount/20),t.totalPage<=1&&(t.isEnd=!0),t.totalPage>1)&&document.querySelector(".member__container").addEventListener("scroll",t.scrollGetOrders);t.getting="",t.$store.dispatch("loading/isLoading",!1)})).catch((function(e){t.getting="",console.log(e)}));case 11:case"end":return e.stop()}}),e)})))()},scrollGetOrders:function(){var t=this,e=document.querySelector("#orderList").getBoundingClientRect().bottom-window.innerHeight;if(!this.isGetting&&!this.isEnd&&e<200){if(this.$store.dispatch("itemLoading/isLoading",!0),this.isGetting=!0,this.isEnd=!1,this.currentPage++,this.currentPage===this.totalPage-1){this.isEnd=!0;var n=document.querySelector(".member__container");null==n||n.removeEventListener("scroll",this.scrollGetOrders)}var o="id, no, date, designer{name, nickName}, status, remarkForCustomer";switch(this.selectTab){case"未完成":this.api.getNotDoneCustomerReservationRecords(o,this.currentPage).then((function(e){t.appointmentRecord=t.appointmentRecord.concat(e.data.getCustomerReservationRecords.orders),t.totalPage=Math.ceil(e.data.getCustomerReservationRecords.totalCount/20),t.totalPage<=1&&(t.isEnd=!0),t.isGetting=!1,t.$store.dispatch("itemLoading/isLoading",!1)})).catch((function(e){t.isGetting=!1,console.log(e)}));break;case"已結束":this.api.getDoneCustomerReservationRecords(o,this.currentPage).then((function(e){t.appointmentRecord=t.appointmentRecord.concat(e.data.getCustomerReservationRecords.orders),t.totalPage=Math.ceil(e.data.getCustomerReservationRecords.totalCount/20),t.totalPage<=1&&(t.isEnd=!0),t.isGetting=!1,t.$store.dispatch("itemLoading/isLoading",!1)})).catch((function(e){t.isGetting=!1,console.log(e)}))}}},isHidden:function(t){var e=Date.now();return t.date<e&&("預約成功"===t.status||"未完成"===t.status)},cancelReservation:function(t,e,n){var o=this,r=new Date(e),c=r.getFullYear(),l=this.formatDate(r.getMonth()+1),d=this.formatDate(r.getDate()),m=this.formatDate(r.getHours()),f=this.formatDate(r.getMinutes()),h=null!=n&&n.name?null==n?void 0:n.name:"不指定";this.$swal.fire({html:'<p class="text-lg">確定要取消<br>\n        <span class="text-[#FEB401] font-bold">'.concat(c,"/").concat(l,"/").concat(d," ").concat(m,":").concat(f," ").concat(h,"</span> \n        的預約嗎？\n        </p>"),showCancelButton:!0,confirmButtonText:"取消預約",confirmButtonColor:"#232D4E",cancelButtonText:"取消"}).then((function(e){e.isConfirmed&&(o.isCancel=t,o.api.customerCancelReservation(t).then((function(e){console.log(e),o.isCancel="",e.hasOwnProperty("errors")?o.$swal.fire({icon:"error",html:e.errors[0].message,background:"#fff",iconColor:"#F43F5E",showConfirmButton:!0}):(o.appointmentRecord=o.appointmentRecord.filter((function(e){return e.id!==t})),o.$swal.fire({icon:"success",title:'<h3 class="text-2xl">取消預約成功</h3>',background:"#fff",iconColor:"#FEB401",timer:1500,showConfirmButton:!1}))})).catch((function(t){o.isCancel="",console.log(t)})))}))},getQuestionAnswer:function(t){var e=this.appointmentRecord.filter((function(e){return e.id===t})),n=e?e[0].troubleShooting:"";this.$swal.fire({html:n,background:"#fff",iconColor:"#232D4E",showConfirmButton:!0})},formatDate:function(t){return t<10?"0".concat(t):t}},mounted:function(){this.getNotDoneOrders()},beforeDestroy:function(){var t=document.querySelector(".member__container");t&&(null==t||t.removeEventListener("scroll",this.scrollGetOrders))}},l=(n(348),n(33)),component=Object(l.a)(c,(function(){var t=this,e=t._self._c;return e("section",{staticClass:"w-full max-w-[768px] mx-auto",attrs:{id:"firstPos"}},[t._m(0),t._v(" "),e("div",{staticClass:"flex justify-center gap-5 text-sm mt-3 mb-4 px-4"},[e("button",{staticClass:"rounded-xl py-2 w-1/2 bg-white border border-[#232D4E] shadow-[0_5px_5px_rgba(0,0,0,0.2)] duration-300",class:{"bg-[#232D4E] text-white shadow-none":"未完成"===t.selectTab},on:{click:function(e){t.selectTab="未完成",t.currentPage=0,t.getNotDoneOrders()}}},[t._v("\n      未完成\n    ")]),t._v(" "),e("button",{staticClass:"rounded-xl py-2 w-1/2 bg-white border border-[#232D4E] shadow-[0_5px_5px_rgba(0,0,0,0.2)] duration-300",class:{"bg-[#232D4E] text-white shadow-none":"已結束"===t.selectTab},on:{click:function(e){t.selectTab="已結束",t.currentPage=0,t.getDoneOrders()}}},[t._v("\n      已結束\n    ")])]),t._v(" "),t.appointmentRecord.length>0?e("div",{attrs:{id:"orderList"}},[t._l(t.appointmentRecord,(function(n){return e("MemberGlobalCard",{key:n.id,attrs:{"data-aos":"zoom-in","data-aos-anchor":"#firstPos","data-aos-once":"true","data-aos-duration":"300",isEdit:n.isEdit}},[e("div",{staticClass:"grid grid-cols-4 gap-3"},[e("div",{pre:!0,attrs:{class:"col-span-1"}},[e("p",{pre:!0,attrs:{class:"text-sm mt-1"}},[t._v("預約日期")])]),t._v(" "),e("div",{staticClass:"col-span-3"},[e("p",{directives:[{name:"formatDate",rawName:"v-formatDate",value:"time",expression:"'time'"}],staticClass:"text-lg font-bold"},[t._v("\n            "+t._s(n.date)+"\n          ")])]),t._v(" "),e("div",{pre:!0,attrs:{class:"col-span-1"}},[e("p",{pre:!0,attrs:{class:"text-sm"}},[t._v("狀態")])]),t._v(" "),e("div",{staticClass:"col-span-3 flex items-center gap-2",class:{"text-[#FEB401]":"未完成"===n.status,"text-[#16A34A]":"預約成功"===n.status||"已完成"===n.status,"text-[#F43F5E]":"設計師已拒絕"===n.status||"設計師已取消"===n.status}},["設計師已取消"!==n.status?e("p",[t._v(t._s(n.status))]):t._e(),t._v(" "),"設計師已取消"===n.status?e("span",[t._v("已取消")]):t._e(),"未完成"===n.status?e("span",{staticClass:"text-xs text-[#666]"},[t._v("(待設計師確認後才算預約完成)")]):t._e()]),t._v(" "),e("div",{pre:!0,attrs:{class:"col-span-1"}},[e("p",{pre:!0,attrs:{class:"text-sm"}},[t._v("設計師")])]),t._v(" "),e("div",{staticClass:"col-span-3"},[n.designer?e("p",{staticClass:"text-sm line-clamp-1"},[t._v("\n            "+t._s(n.designer.name)+"\n            "),n.designer.nickName?e("span",[t._v("("+t._s(n.designer.nickName)+")")]):t._e()]):e("p",{staticClass:"text-sm"},[t._v("不指定")])]),t._v(" "),n.remarkForCustomer?e("div",{staticClass:"col-span-1"},[e("p",{staticClass:"text-sm"},[t._v("備註")])]):t._e(),t._v(" "),n.remarkForCustomer?e("div",{staticClass:"col-span-3"},[e("p",{staticClass:"text-sm"},[t._v(t._s(n.remarkForCustomer))])]):t._e(),t._v(" "),n.messageForCustomer?e("div",{staticClass:"col-span-1"},[e("p",{staticClass:"text-sm"},[t._v("設計師留言")])]):t._e(),t._v(" "),n.messageForCustomer?e("div",{staticClass:"col-span-3"},[e("p",{staticClass:"text-sm"},[t._v(t._s(n.messageForCustomer))])]):t._e(),t._v(" "),n.isEdit?e("div",{staticClass:"col-span-1"},[e("div",{staticClass:"flex items-center gap-1 mt-5"},[e("fa",{staticClass:"text-[#aeaeae] text-xs",attrs:{icon:"fa-light fa-pen"}}),t._v(" "),e("p",{staticClass:"text-[#aeaeae] text-xs"},[t._v("已修改")])],1)]):t._e()]),t._v(" "),"設計師已取消"===n.status||"設計師已拒絕"===n.status||"已完成"===n.status?e("button",{staticClass:"w-full mt-4 py-2 text-white text-sm bg-[#FEB401]",attrs:{"data-mdb-ripple":"true","data-mdb-ripple-color":"light"},on:{click:function(e){return t.$router.push("/member/appointment")}}},[e("p",{staticClass:"text-sm"},[t._v("重新預約")])]):e("button",{staticClass:"w-full mt-4 py-2 text-white text-sm flex items-center justify-center gap-2",class:{hidden:t.isHidden(n),"bg-[#F43F5E]":t.isCancel!==n.id,"bg-[#bebebe]":t.isCancel===n.id},on:{click:function(e){return t.cancelReservation(n.id,n.date,n.designer)}}},[t.isCancel===n.id?e("fa",{staticClass:"animate-spin",attrs:{icon:"fa-solid fa-spinner"}}):t._e(),t._v(" "),e("p",{staticClass:"text-sm"},[t._v("取消預約")])],1),t._v(" "),e("button",{staticClass:"question",on:{click:function(e){return t.getQuestionAnswer(n.id)}}},[t._v("？")])])})),t._v(" "),e("ItemLoading")],2):t._e(),t._v(" "),0!==t.appointmentRecord.length||t.isLoading?t._e():e("div",[e("MemberGlobalCard",{attrs:{customCss:"min-h-[200px] flex items-center justify-center","data-aos":"zoom-in","data-aos-once":"true","data-aos-duration":"300"}},[e("p",{staticClass:"text-[#555]"},[t._v("目前尚無紀錄")])])],1)])}),[function(){var t=this,e=t._self._c;return e("div",{staticClass:"fixed left-0 top-0 w-full px-[10%] text-lg bg-white py-4 flex items-center"},[e("fa",{staticClass:"text-2xl",attrs:{icon:"fa-solid fa-angle-left"},on:{click:function(e){return t.$router.go(-1)}}}),t._v(" "),e("h2",{pre:!0,attrs:{class:"absolute top-1/2 translate-y-[-50%] left-[50%] translate-x-[-50%] text-lg font-bold"}},[t._v("\n      預約記錄\n    ")])],1)}],!1,null,null,null);e.default=component.exports;installComponents(component,{MemberGlobalCard:n(331).default,ItemLoading:n(332).default})}}]);